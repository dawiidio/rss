import { promises } from 'node:fs';
import { join } from 'node:path';

const { readFile, writeFile } = promises;

const generateTypeForItunesCategories = (categories) => `
// THIS FILE IS AUTOGENERATED, IF YOU WANT TO CHANGE IT
// SEE static/itunes-categories.json AND scripts/generate-itunes-category-types.mjs
// THEN RUN npm run build:itunes:categories

export type ItunesCategoryObject = {
${categories.reduce((acc, {
    category,
    subcategories,
}) => acc + `\n    '${category}': Array<${subcategories.map((c) => `'${c}' `).join('|') || 'never'}>`, ``)}
};
`;

const main = async () => {
    const str = (await readFile(join('.', 'static', 'itunes-categories.json'))).toString('utf-8');
    const categoriesArray = JSON.parse(str);

    const types = generateTypeForItunesCategories(categoriesArray);

    await writeFile(join('.', 'src', 'external', 'ItunesCategory.ts'), types);
};

main();
